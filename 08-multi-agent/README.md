
[![다중 에이전트 디자인](./images/lesson-8-thumbnail.png)](https://youtu.be/V6HpE9hZEx0?si=A7K44uMCqgvLQVCa)

> _(👆 이미지를 클릭하면 이번 레슨의 강의 영상을 볼 수 있어요!)_

# 🤝 다중 에이전트 디자인 패턴 - 여러 명의 전문가가 함께 일하는 법

여러 에이전트가 관련된 프로젝트를 시작하자마자, 다중 에이전트 디자인 패턴을 고려해야 할 필요성을 느끼게 될 거예요. 하지만 언제 다중 에이전트로 전환해야 하는지, 그리고 그 장점이 무엇인지는 처음에는 명확하지 않을 수 있습니다.

## 🧐 소개

이번 레슨에서는 다음 질문들에 대한 답을 찾아보려고 해요:

- 다중 에이전트를 적용할 수 있는 시나리오는 어떤 것들이 있나요?
- 하나의 에이전트가 여러 작업을 수행하는 것보다 다중 에이전트를 사용하는 것의 장점은 무엇인가요?
- 다중 에이전트 디자인 패턴을 구현하기 위한 구성 요소는 무엇인가요?
- 여러 에이전트가 서로 어떻게 상호작용하는지에 대한 가시성을 확보하려면 어떻게 해야 하나요?

## 📚 학습 목표

이번 레슨을 완료하면 다음을 할 수 있게 됩니다:

- 다중 에이전트를 적용할 수 있는 시나리오를 식별할 수 있습니다.
- 단일 에이전트보다 다중 에이전트를 사용하는 것의 장점을 인식할 수 있습니다.
- 다중 에이전트 디자인 패턴을 구현하기 위한 구성 요소를 이해할 수 있습니다.

**더 큰 그림은 무엇일까요?**

*다중 에이전트는 여러 에이전트가 함께 협력하여 공통 목표를 달성할 수 있도록 하는 디자인 패턴입니다.*

이 패턴은 로봇 공학, 자율 시스템, 분산 컴퓨팅을 포함한 다양한 분야에서 널리 사용됩니다.

---

## 💡 다중 에이전트를 적용할 수 있는 시나리오

그렇다면 어떤 시나리오가 다중 에이전트를 사용하기 좋은 사례일까요? 특히 다음과 같은 경우에 여러 에이전트를 사용하는 것이 유익한 시나리오가 많이 있습니다:

- **대규모 작업 (Large workloads)**: 대규모 작업을 더 작은 작업으로 나누어 여러 에이전트에 할당하면 병렬 처리가 가능해져 더 빠르게 완료할 수 있습니다. 대규모 데이터 처리 작업이 좋은 예입니다.
- **복잡한 작업 (Complex tasks)**: 대규모 작업과 마찬가지로 복잡한 작업도 더 작은 하위 작업으로 나누어 작업의 특정 측면을 전문으로 하는 여러 에이전트에 할당할 수 있습니다. 자율 주행 자동차의 경우 내비게이션, 장애물 감지, 다른 차량과의 통신을 각각 다른 에이전트가 관리하는 것이 좋은 예입니다.
- **다양한 전문성 (Diverse expertise)**: 각 에이전트는 다양한 전문 지식을 가질 수 있어 단일 에이전트보다 작업의 여러 측면을 더 효과적으로 처리할 수 있습니다. 이 경우 의료 분야에서 에이전트가 진단, 치료 계획, 환자 모니터링을 관리할 수 있는 것이 좋은 예입니다.

---

## 🚀 단일 에이전트 대비 다중 에이전트 사용의 장점

단일 에이전트 시스템은 간단한 작업에는 잘 작동할 수 있지만, 더 복잡한 작업의 경우 여러 에이전트를 사용하면 몇 가지 장점을 제공할 수 있습니다:

- **전문화 (Specialization)**: 각 에이전트는 특정 작업에 특화될 수 있습니다. 단일 에이전트의 전문화 부족은 모든 것을 할 수 있지만 복잡한 작업에 직면했을 때 무엇을 해야 할지 혼란스러울 수 있는 에이전트를 의미합니다. 예를 들어, 가장 적합하지 않은 작업을 수행하게 될 수도 있습니다.
- **확장성 (Scalability)**: 단일 에이전트에 과부하를 주는 것보다 더 많은 에이전트를 추가하여 시스템을 확장하는 것이 더 쉽습니다.
- **내결함성 (Fault Tolerance)**: 하나의 에이전트가 실패하더라도 다른 에이전트는 계속 기능하여 시스템 안정성을 보장할 수 있습니다.

예를 들어, 사용자를 위한 여행을 예약한다고 가정해 보겠습니다. 단일 에이전트 시스템은 항공편 찾기부터 호텔 예약, 렌터카 예약까지 여행 예약 프로세스의 모든 측면을 처리해야 합니다. 단일 에이전트로 이를 달성하려면 에이전트가 이러한 모든 작업을 처리할 수 있는 도구를 갖추어야 합니다. 이는 유지 관리 및 확장이 어려운 복잡하고 모놀리식한 시스템으로 이어질 수 있습니다. 반면, 다중 에이전트 시스템은 항공편 찾기, 호텔 예약, 렌터카 예약에 특화된 다양한 에이전트를 가질 수 있습니다. 이렇게 하면 시스템이 더 모듈화되고 유지 관리가 쉬워지며 확장 가능해집니다.

이를 동네 여행사와 프랜차이즈 여행사를 비교해 볼 수 있습니다. 동네 여행사는 단일 에이전트가 여행 예약 프로세스의 모든 측면을 처리하는 반면, 프랜차이즈는 여행 예약 프로세스의 다양한 측면을 처리하는 여러 에이전트를 두고 있을 것입니다.

---

## 🧩 다중 에이전트 디자인 패턴 구현을 위한 구성 요소

다중 에이전트 디자인 패턴을 구현하기 전에 패턴을 구성하는 구성 요소를 이해해야 합니다.

사용자를 위한 여행 예약 예시를 다시 들어 이를 더 구체적으로 살펴보겠습니다. 이 경우 구성 요소는 다음과 같습니다:

- **에이전트 통신 (Agent Communication)**: 항공편 찾기, 호텔 예약, 렌터카 예약을 위한 에이전트는 사용자의 선호도와 제약 조건에 대한 정보를 통신하고 공유해야 합니다. 이 통신을 위한 프로토콜과 방법을 결정해야 합니다. 구체적으로 말하면, 항공편을 찾는 에이전트는 호텔 예약 에이전트와 통신하여 호텔이 항공편과 동일한 날짜에 예약되었는지 확인해야 합니다. 즉, 에이전트가 사용자의 여행 날짜에 대한 정보를 공유해야 하므로, *어떤 에이전트가 정보를 공유하고 어떻게 공유하는지* 결정해야 합니다.
- **조정 메커니즘 (Coordination Mechanisms)**: 에이전트는 사용자의 선호도와 제약 조건이 충족되도록 작업을 조정해야 합니다. 사용자 선호도는 공항 근처 호텔을 원하는 것일 수 있고, 제약 조건은 렌터카가 공항에서만 이용 가능한 것일 수 있습니다. 즉, 호텔 예약 에이전트는 렌터카 예약 에이전트와 조정하여 사용자의 선호도와 제약 조건이 충족되도록 해야 합니다. 이는 *에이전트가 작업을 어떻게 조정하는지* 결정해야 함을 의미합니다.
- **에이전트 아키텍처 (Agent Architecture)**: 에이전트는 결정을 내리고 사용자와의 상호작용을 통해 학습할 수 있는 내부 구조를 가져야 합니다. 즉, 항공편 찾기 에이전트는 사용자에게 어떤 항공편을 추천할지 결정할 수 있는 내부 구조를 가져야 합니다. 이는 *에이전트가 어떻게 결정을 내리고 사용자와의 상호작용을 통해 학습하는지* 결정해야 함을 의미합니다. 에이전트가 학습하고 개선하는 방법의 예로, 항공편 찾기 에이전트가 기계 학습 모델을 사용하여 사용자의 과거 선호도에 기반한 항공편을 추천할 수 있습니다.
- **다중 에이전트 상호작용에 대한 가시성 (Visibility into Multi-Agent Interactions)**: 여러 에이전트가 서로 어떻게 상호작용하는지에 대한 가시성을 확보해야 합니다. 즉, 에이전트 활동과 상호작용을 추적하기 위한 도구와 기술이 필요합니다. 이는 로깅 및 모니터링 도구, 시각화 도구, 성능 메트릭 형태일 수 있습니다.
- **다중 에이전트 패턴 (Multi-Agent Patterns)**: 중앙 집중식, 분산식, 하이브리드 아키텍처 등 다중 에이전트 시스템을 구현하기 위한 다양한 패턴이 있습니다. 사용 사례에 가장 적합한 패턴을 결정해야 합니다.
- **사람-개입 루프 (Human in the loop)**: 대부분의 경우 사람이 개입하는 루프가 있으며, 에이전트에게 언제 사람의 개입을 요청해야 하는지 지시해야 합니다. 이는 사용자가 에이전트가 추천하지 않은 특정 호텔이나 항공편을 요청하거나, 항공편이나 호텔을 예약하기 전에 확인을 요청하는 형태일 수 있습니다.

---

## 🔍 다중 에이전트 상호작업에 대한 가시성 확보

여러 에이전트가 서로 어떻게 상호작용하는지에 대한 가시성을 확보하는 것이 중요합니다. 이러한 가시성은 디버깅, 최적화, 전반적인 시스템 효율성 보장에 필수적입니다. 이를 위해 에이전트 활동과 상호작용을 추적하는 도구와 기술이 필요합니다. 이는 로깅 및 모니터링 도구, 시각화 도구, 성능 메트릭 형태일 수 있습니다.

예를 들어, 사용자를 위한 여행 예약의 경우 각 에이전트의 상태, 사용자의 선호도 및 제약 조건, 에이전트 간의 상호작용을 보여주는 대시보드를 가질 수 있습니다. 이 대시보드는 사용자의 여행 날짜, 항공편 에이전트가 추천한 항공편, 호텔 에이전트가 추천한 호텔, 렌터카 에이전트가 추천한 렌터카를 보여줄 수 있습니다. 이를 통해 에이전트가 서로 어떻게 상호작용하는지, 사용자의 선호도와 제약 조건이 충족되고 있는지 명확하게 파악할 수 있습니다.

각 측면을 더 자세히 살펴보겠습니다.

- **로깅 및 모니터링 도구 (Logging and Monitoring Tools)**: 에이전트가 수행하는 모든 작업에 대해 로깅을 수행하려고 할 것입니다. 로그 항목에는 작업을 수행한 에이전트, 수행된 작업, 작업이 수행된 시간, 작업 결과에 대한 정보를 저장할 수 있습니다. 이 정보는 디버깅, 최적화 등에 사용될 수 있습니다.
- **시각화 도구 (Visualization Tools)**: 시각화 도구는 에이전트 간의 상호작용을 보다 직관적인 방식으로 볼 수 있도록 도와줍니다. 예를 들어, 에이전트 간의 정보 흐름을 보여주는 그래프를 가질 수 있습니다. 이는 시스템의 병목 현상, 비효율성 및 기타 문제를 식별하는 데 도움이 될 수 있습니다.
- **성능 메트릭 (Performance Metrics)**: 성능 메트릭은 다중 에이전트 시스템의 효율성을 추적하는 데 도움이 될 수 있습니다. 예를 들어, 작업을 완료하는 데 걸린 시간, 단위 시간당 완료된 작업 수, 에이전트가 만든 추천의 정확성을 추적할 수 있습니다. 이 정보는 개선 영역을 식별하고 시스템을 최적화하는 데 도움이 될 수 있습니다.

---

## 🏗️ 다중 에이전트 패턴

다중 에이전트 앱을 만드는 데 사용할 수 있는 몇 가지 구체적인 패턴을 자세히 살펴보겠습니다. 고려해 볼 만한 몇 가지 흥미로운 패턴은 다음과 같습니다:

### 그룹 채팅 (Group chat)

이 패턴은 여러 에이전트가 서로 통신할 수 있는 그룹 채팅 애플리케이션을 만들고자 할 때 유용합니다. 이 패턴의 일반적인 사용 사례로는 팀 협업, 고객 지원, 소셜 네트워킹이 있습니다.

이 패턴에서 각 에이전트는 그룹 채팅의 사용자를 나타내며, 메시지는 메시징 프로토콜을 사용하여 에이전트 간에 교환됩니다. 에이전트는 그룹 채팅에 메시지를 보내고, 그룹 채팅에서 메시지를 수신하며, 다른 에이전트의 메시지에 응답할 수 있습니다.

이 패턴은 모든 메시지가 중앙 서버를 통해 라우팅되는 중앙 집중식 아키텍처나 메시지가 직접 교환되는 분산 아키텍처를 사용하여 구현할 수 있습니다.

![그룹 채팅](./images/multi-agent-group-chat.png)

### 작업 인계 (Hand-off)

이 패턴은 여러 에이전트가 서로에게 작업을 인계할 수 있는 애플리케이션을 만들고자 할 때 유용합니다.

이 패턴의 일반적인 사용 사례로는 고객 지원, 작업 관리, 워크플로우 자동화가 있습니다.

이 패턴에서 각 에이전트는 워크플로우의 작업 또는 단계를 나타내며, 에이전트는 미리 정의된 규칙에 따라 다른 에이전트에게 작업을 인계할 수 있습니다.

![작업 인계](./images/multi-agent-hand-off.png)

### 협업 필터링 (Collaborative filtering)

이 패턴은 여러 에이전트가 협력하여 사용자에게 추천을 제공할 수 있는 애플리케이션을 만들고자 할 때 유용합니다.

여러 에이전트가 협력하길 원하는 이유는 각 에이전트가 다양한 전문 지식을 가질 수 있고 추천 프로세스에 다양한 방식으로 기여할 수 있기 때문입니다.

사용자가 주식 시장에서 매수하기 가장 좋은 주식에 대한 추천을 원하는 예를 들어 보겠습니다.

- **산업 전문가 (Industry expert)**: 한 에이전트는 특정 산업의 전문가일 수 있습니다.
- **기술적 분석 (Technical analysis)**: 다른 에이전트는 기술적 분석의 전문가일 수 있습니다.
- **기본적 분석 (Fundamental analysis)**: 또 다른 에이전트는 기본적 분석의 전문가일 수 있습니다. 협력을 통해 이러한 에이전트는 사용자에게 더 포괄적인 추천을 제공할 수 있습니다.

![협업 추천](./images/multi-agent-filtering.png)

---

## 📦 시나리오: 환불 프로세스

고객이 제품에 대한 환불을 받으려고 하는 시나리오를 생각해 보겠습니다. 이 프로세스에는 꽤 많은 에이전트가 관련될 수 있지만, 이 프로세스에 특화된 에이전트와 다른 프로세스에서도 사용할 수 있는 일반 에이전트로 나누어 보겠습니다.

**환불 프로세스에 특화된 에이전트**:

환불 프로세스에 관련될 수 있는 몇 가지 에이전트는 다음과 같습니다:

- **고객 에이전트 (Customer agent)**: 이 에이전트는 고객을 대표하며 환불 프로세스를 시작하는 역할을 합니다.
- **판매자 에이전트 (Seller agent)**: 이 에이전트는 판매자를 대표하며 환불을 처리하는 역할을 합니다.
- **결제 에이전트 (Payment agent)**: 이 에이전트는 결제 프로세스를 대표하며 고객의 결제를 환불하는 역할을 합니다.
- **해결 에이전트 (Resolution agent)**: 이 에이전트는 해결 프로세스를 대표하며 환불 프로세스 중에 발생하는 모든 문제를 해결하는 역할을 합니다.
- **규정 준수 에이전트 (Compliance agent)**: 이 에이전트는 규정 준수 프로세스를 대표하며 환불 프로세스가 규정 및 정책을 준수하는지 확인하는 역할을 합니다.

**일반 에이전트**:

이 에이전트들은 비즈니스의 다른 부분에서도 사용될 수 있습니다.

- **배송 에이전트 (Shipping agent)**: 이 에이전트는 배송 프로세스를 대표하며 제품을 판매자에게 다시 배송하는 역할을 합니다. 이 에이전트는 환불 프로세스와 예를 들어 구매를 통한 제품의 일반 배송 모두에 사용될 수 있습니다.
- **피드백 에이전트 (Feedback agent)**: 이 에이전트는 피드백 프로세스를 대표하며 고객으로부터 피드백을 수집하는 역할을 합니다. 피드백은 환불 프로세스 중에만이 아니라 언제든지 수집될 수 있습니다.
- **에스컬레이션 에이전트 (Escalation agent)**: 이 에이전트는 에스컬레이션 프로세스를 대표하며 문제를 더 높은 수준의 지원으로 에스컬레이션하는 역할을 합니다. 이 유형의 에이전트는 문제를 에스컬레이션해야 하는 모든 프로세스에 사용할 수 있습니다.
- **알림 에이전트 (Notification agent)**: 이 에이전트는 알림 프로세스를 대표하며 환불 프로세스의 여러 단계에서 고객에게 알림을 보내는 역할을 합니다.
- **분석 에이전트 (Analytics agent)**: 이 에이전트는 분석 프로세스를 대표하며 환불 프로세스와 관련된 데이터를 분석하는 역할을 합니다.
- **감사 에이전트 (Audit agent)**: 이 에이전트는 감사 프로세스를 대표하며 환불 프로세스가 올바르게 수행되고 있는지 감사하는 역할을 합니다.
- **보고 에이전트 (Reporting agent)**: 이 에이전트는 보고 프로세스를 대표하며 환불 프로세스에 대한 보고서를 생성하는 역할을 합니다.
- **지식 에이전트 (Knowledge agent)**: 이 에이전트는 지식 프로세스를 대표하며 환불 프로세스와 관련된 정보의 지식 기반을 유지 관리하는 역할을 합니다. 이 에이전트는 환불 및 비즈니스의 다른 부분에 대해 모두 잘 알 수 있습니다.
- **보안 에이전트 (Security agent)**: 이 에이전트는 보안 프로세스를 대표하며 환불 프로세스의 보안을 보장하는 역할을 합니다.
- **품질 에이전트 (Quality agent)**: 이 에이전트는 품질 프로세스를 대표하며 환불 프로세스의 품질을 보장하는 역할을 합니다.

앞서 환불 프로세스에 특화된 에이전트뿐만 아니라 비즈니스의 다른 부분에서도 사용할 수 있는 일반 에이전트까지 꽤 많은 에이전트가 나열되었습니다. 이것이 다중 에이전트 시스템에서 사용할 에이전트를 결정하는 방법에 대한 아이디어를 제공했기를 바랍니다.

---

## ✍️ 과제

고객 지원 프로세스를 위한 다중 에이전트 시스템을 설계해 보세요. 프로세스에 관련된 에이전트, 그들의 역할과 책임, 그리고 서로 어떻게 상호작용하는지 식별하세요. 고객 지원 프로세스에 특화된 에이전트와 비즈니스의 다른 부분에서 사용할 수 있는 일반 에이전트를 모두 고려하세요.

> 해결책을 읽기 전에 한번 생각해 보세요. 생각보다 더 많은 에이전트가 필요할 수도 있습니다.

> 💡 팁: 고객 지원 프로세스의 여러 단계에 대해 생각해 보고 모든 시스템에 필요한 에이전트도 고려하세요.

---

## ✅ 해결책

- **과제 해결책**: [해결책 보기](./solution/solution.md)
- **퀴즈 해결책**: [퀴즈 해결책 보기](./solution/solution-quiz.md)

---

## 📝 지식 확인

질문: 언제 다중 에이전트 사용을 고려해야 할까요?

- [ ] A1: 작업량이 적고 작업이 간단할 때
- [ ] A2: 작업량이 많을 때
- [ ] A3: 작업이 간단할 때

---

## 📚 요약

이번 레슨에서는 다중 에이전트 디자인 패턴에 대해 살펴보았습니다. 여기에는 다중 에이전트를 적용할 수 있는 시나리오, 단일 에이전트보다 다중 에이전트를 사용하는 것의 장점, 다중 에이전트 디자인 패턴 구현을 위한 구성 요소, 그리고 여러 에이전트가 서로 어떻게 상호작용하는지에 대한 가시성을 확보하는 방법이 포함됩니다.

---

## ❓ 다중 에이전트 디자인 패턴에 대해 더 궁금한 점이 있나요?

[Azure AI Foundry Discord](https://aka.ms/ai-agents/discord)에 참여하여 다른 학습자들을 만나고, 오피스 아워에 참여하고 AI Agents에 대한 질문에 대한 답변을 받아보세요.

---

## 📚 추가 자료

- <a href="https://microsoft.github.io/autogen/stable/user-guide/core-user-guide/design-patterns/intro.html" target="_blank">AutoGen 디자인 패턴 (영문)</a>
- <a href="https://www.analyticsvidhya.com/blog/2024/10/agentic-design-patterns/" target="_blank">에이전틱 디자인 패턴 (영문)</a>

---

## 📚 레슨 목차

### ⬅️ 이전 레슨

[7강: 계획(Planning) 디자인 패턴](../07-planning-design/README.md)

### ➡️ 다음 레슨

[9강: AI 에이전트의 메타인지](../09-metacognition/README.md)

---

*이 가이드가 여러분이 여러 명의 AI 전문가들을 조율하여 더 복잡하고 멋진 일을 해내는 데 도움이 되길 바랍니다!* 🤝
